<div class="tab magic">
    <div>
        <div class="mproj">
            <h5>
                {{localize "abfalter.magicTab.mproj"}}
                <label class="expand-box">
                    <a class="toggleBoolean {{#if system.mproj.status}}showOpacity{{/if}}" data-label="system.mproj.status" data-ability="{{system.mproj.status}}"><i class="{{#if system.mproj.status}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                </label>
            </h5>
            {{#if system.mproj.status}}
            <div>
                <label> <span> {{localize "abfalter.basicInfo.base"}} </span> <input type="number" name="system.mproj.base" value="{{system.mproj.base}}" /> </label>
                <label> 
                    <span> {{localize "abfalter.basicInfo.spec"}} </span>
                    <input type="number" name="system.mproj.spec" value="{{system.mproj.spec}}" />
                    <input type="number" name="system.mproj.spec2" value="{{system.mproj.spec2}}" /> 
                </label>
                <label class="{{#if system.toggles.magicAtkModule}}hidden{{/if}}"> <span> {{localize "abfalter.magicTab.imbalance"}} </span> <input type="number" name="system.mproj.imbalance" value="{{system.mproj.imbalance}}" /> </label>
            </div>
            {{/if}}
            <label>
                <span> {{localize "abfalter.basicInfo.temp"}} </span>
                <input type="number" name="system.mproj.temp" value="{{system.mproj.temp}}" />
                <input type="number" name="system.mproj.temp2" value="{{system.mproj.temp2}}" />
            </label>
            
            <div class="mProjButton">
                {{#if system.toggles.magicAtkModule}}
                <button type="button" class="combatRoll" data-roll="{{system.atkfinal}}" data-label="{{localize "abfalter.basicInfo.attack"}}" data-type="combatRoll">
                    <span> {{localize "abfalter.magicTab.offensive"}} </span> <span> {{system.mprojAtkModule}} </span>
                </button>
                {{else}}
                <button type="button" class="combatRoll" data-roll="{{system.mprojfinaloff}}" data-label="Magic Proj. Offensive" data-type="combatRoll"> 
                    <span> {{localize "abfalter.magicTab.offensive"}} </span> <span> {{system.mprojfinaloff}} </span>
                </button>
                {{/if}}
                {{#if system.toggles.magicDefModule}}
                {{#if system.toggles.magicDodgeModule}}
                <button type="button" class="combatRoll" data-roll="{{system.dodfinal}}" data-label="{{localize "abfalter.basicInfo.dodge"}}" data-type="combatRoll">
                    <span> {{localize "abfalter.magicTab.defensive"}} </span> <span> {{system.mprojDodModule}} </span>
                </button>
                {{else}}
                <button type="button" class="combatRoll" data-roll="{{system.blkfinal}}" data-label="{{localize "abfalter.basicInfo.block"}}" data-type="combatRoll">
                    <span> {{localize "abfalter.magicTab.defensive"}} </span> <span> {{system.mprojDefModule}} </span>
                </button>
                {{/if}}
                {{else}}
                <button type="button" class="combatRoll" data-roll="{{system.mprojfinaldef}}" data-label="Magic Proj. Defensive" data-type="combatRoll">
                    <span> {{localize "abfalter.magicTab.defensive"}} </span> <span> {{system.mprojfinaldef}} </span>
                </button>
                {{/if}}
            </div>

            <h6 class="{{#if system.toggles.magicTheoryVis}}hidden{{/if}}"> {{localize "abfalter.magicTab.mtheory"}} </h6>
            <div class="csSelect2 {{#if system.toggles.magicTheoryVis}}hidden{{/if}}">
                <label>
                    <select name="system.mproj.mtheory">
                        {{selectOptions MagicTheoryObjList selected=system.mproj.mtheory localize=true}}
                    </select>
                </label>
            </div>
        </div><!--Magic Projection-->

        <div class="maccu">
            <h5> {{localize "abfalter.magicTab.maccu"}} </h5>
            <div>
                <div class="maccu2">
                    <h6>
                        {{localize "abfalter.magicTab.maccua"}}
                        <label class="expand-box">
                            <a class="toggleBoolean {{#if system.maccu.status}}showOpacity{{/if}}" data-label="system.maccu.status" data-ability="{{system.maccu.status}}"><i class="{{#if system.maccu.status}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </label>
                    </h6>
                    {{#if system.maccu.status}}
                    <div>
                        <label> <span> {{localize "abfalter.basicInfo.base"}} </span> <input type="number" name="system.maccu.base" value="{{system.maccu.base}}" /> </label>
                        <label> <span> {{localize "abfalter.magicTab.frompow"}} </span> <input type="number" name="system.maccupow" value="{{system.maccupow}}" readonly /> </label>
                        <label> <span> {{localize "abfalter.basicInfo.mult"}} </span> <input type="number" name="system.maccu.mult" value="{{system.maccu.mult}}" /> </label>
                        <label> <span> {{localize "abfalter.basicInfo.spec"}} </span> <input type="number" name="system.maccu.spec" value="{{system.maccu.spec}}" /> </label>
                    </div>
                    {{/if}}
                    <label> <span> {{localize "abfalter.basicInfo.temp"}} </span> <input type="number" name="system.maccu.temp" value="{{system.maccu.temp}}" /> </label>
                    <label> <span> {{localize "abfalter.basicInfo.final"}} </span> <input type="number" name="system.maccufinal" value="{{system.maccufinal}}" readonly /> </label>
                    <label> <span> {{localize "abfalter.basicInfo.actual"}} </span> <input type="number" name="system.maccu.actual" value="{{system.maccu.actual}}" /> </label>
                    <div>
                        <button type="button" class="maccuHalf" data-ability="{{system.maccuhalffinal}}">
                            <span> {{localize "abfalter.basicInfo.half"}} </span>
                        </button><!--
                        --><button type="button" class="maccuFull" data-ability="{{system.maccufinal}}">
                            <span> {{localize "abfalter.basicInfo.full"}} </span>
                        </button>
                    </div>
                </div><!--Accumulation-->
                <div class="mregen2">
                    <h6>
                        {{localize "abfalter.magicTab.maccur"}}
                        <label class="expand-box">
                            <a class="toggleBoolean {{#if system.mregen.status}}showOpacity{{/if}}" data-label="system.mregen.status" data-ability="{{system.mregen.status}}"><i class="{{#if system.mregen.status}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </label>
                    </h6>
                    {{#if system.mregen.status}}
                    <div>
                        <label> <span> {{localize "abfalter.magicTab.regenmult"}} </span> <input type="number" name="system.mregen.regenmult" value="{{system.mregen.regenmult}}" /> </label>
                        <label> <span> {{localize "abfalter.basicInfo.spec"}} </span> <input type="number" name="system.mregen.spec" value="{{system.mregen.spec}}" /> </label>
                        <label> <span> {{localize "abfalter.magicTab.recoverymult"}} </span> <input type="number" name="system.mregen.recoverymult" value="{{system.mregen.recoverymult}}" /> </label>
                    </div>
                    {{/if}}
                    <label> <span> {{localize "abfalter.basicInfo.temp"}} </span> <input type="number" name="system.mregen.temp" value="{{system.mregen.temp}}" /> </label>
                    <label> <span> {{localize "abfalter.magicTab.finalregen"}} </span> <input type="number" name="system.mregenfinal" value="{{system.mregenfinal}}" readonly /> </label>
                    <div>
                        <button type="button" class="mregenFull" data-ability="{{system.mregenfinal}}" data-ability2="{{system.zeon.max}}">
                            <span> {{localize "abfalter.basicInfo.full"}} </span>
                        </button>
                    </div>
                </div><!--Regeneration-->
            </div>
        </div><!--Magic Accumulation-->

        <div class="zeon">
            <h5>
                {{localize "abfalter.magicTab.zeon"}}
                <label class="expand-box">
                    <a class="toggleBoolean {{#if system.zeon.status}}showOpacity{{/if}}" data-label="system.zeon.status" data-ability="{{system.zeon.status}}"><i class="{{#if system.zeon.status}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                </label>
            </h5>
            {{#if system.zeon.status}}
            <div>
                <label> <span> {{localize "abfalter.basicInfo.base"}} </span> <input type="number" name="system.zeon.base" value="{{system.zeon.base}}" /> </label>
                <label> <span> {{localize "abfalter.magicTab.frompow"}} </span> <input type="number" name="system.zeonpow" value="{{system.zeonpow}}" readonly /> </label>
                <label> <span> {{localize "abfalter.basicInfo.class"}} </span> <input type="number" name="system.zeonbonus" value="{{system.zeonbonus}}" readonly /> </label>
                <label> <span> {{localize "abfalter.basicInfo.spec"}} </span> <input type="number" name="system.zeon.spec" value="{{system.zeon.spec}}" /> </label>
            </div>
            {{/if}}
            <label> <span> {{localize "abfalter.basicInfo.temp"}} </span> <input type="number" name="system.zeon.temp" value="{{system.zeon.temp}}" /> </label>
            <label> <span> {{localize "abfalter.basicInfo.final"}} </span> <input type="number" name="system.zeon.max" value="{{system.zeon.max}}" readonly /> </label>
            <label> <span> {{localize "abfalter.basicInfo.actual"}} </span> <input type="number" name="system.zeon.value" value="{{system.zeon.value}}" /> </label>
            <div class="minnate {{#if system.toggles.innateMagicVis}}hidden{{/if}}">
                <h6> {{localize "abfalter.magicTab.minnate"}} </h6>
                <div>
                    <div>
                        <span> {{localize "abfalter.basicInfo.bonus"}} </span>
                        <label> <input type="number" name="system.zeon.minnate" value="{{system.zeon.minnate}}" /> </label>
                    </div>
                    <div>
                        <span> {{localize "abfalter.basicInfo.final"}} </span>
                        <label> <input type="number" name="system.minnatefinal" value="{{system.minnatefinal}}" readonly /> </label>
                    </div>
                </div>
            </div>
        </div><!--Zeon-->
    </div>

    <div class="s1">
        <div>
            <div class="s2">
                <div class="mlevels {{#if system.toggles.spellcastingVis}}hidden{{/if}}">
                    <h5>
                        {{localize "abfalter.magicTab.mLevels"}}
                        <label class="expand-box">
                            <a class="toggleBoolean {{#if system.mlevel.status}}showOpacity{{/if}}" data-label="system.mlevel.status" data-ability="{{system.mlevel.status}}"><i class="{{#if system.mlevel.status}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </label>
                    </h5>
                    {{#if system.mlevel.status}}
                    <div>
                        <label> <span> {{localize "abfalter.basicInfo.base"}} </span> <input type="number" name="system.mlevel.base" value="{{system.mlevel.base}}" /> </label>
                        <label> <span> {{localize "abfalter.magicTab.fromInt"}} </span> <input type="number" name="system.mlevelint" value="{{system.mlevelint}}" readonly /> </label>
                        <label> <span> {{localize "abfalter.basicInfo.spec"}} </span> <input type="number" name="system.mlevel.spec" value="{{system.mlevel.spec}}" /> </label>
                    </div>
                    {{/if}}
                    <label> <span> {{localize "abfalter.basicInfo.extra"}} </span> <input type="number" name="system.mlevel.temp" value="{{system.mlevel.temp}}" /> </label>
                    <label> <span> {{localize "abfalter.basicInfo.final"}} </span> <input type="number" name="system.mlevelfinal" value="{{system.mlevelfinal}}" readonly /> </label>
                    <label> <span> {{localize "abfalter.basicInfo.used"}} </span> <input type="number" name="system.mlevelused" value="{{system.mlevelused}}" readonly /> </label>
                </div>

                <div class="spellPath {{#if system.toggles.spellcastingVis}}hidden{{/if}}">
                    <h5> {{localize "abfalter.magicTab.spellPath"}} </h5>
                    <div>
                        <span> {{localize "abfalter.magicTab.spellPath"}} </span>
                        <span> {{localize "abfalter.basicInfo.level"}} </span>
                    </div>
                    <div class="{{#if system.itemToggle.spellPath}}item-list{{/if}}">
                        {{#each spellPaths as |spellPath id|}}
                        <div class="spellPath-item item delete-item" data-item-id="{{spellPath._id}}">
                            {{#if system.toggleItem}}
                            <div>
                                <input class="inline-edit" data-field="name" type="text" value="{{spellPath.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                                <input class="inline-edit" data-field="system.level" type="number" value="{{spellPath.system.level}}" />
                            </div>
                            {{else}}
                            <div>
                                <span> {{spellPath.name}} </span>
                                <span> {{spellPath.system.level}} </span>
                            </div>
                            {{/if}}
                        </div>
                        {{/each}}
                    </div>
                    <div>
                        <a class="item-create" data-type="spellPath"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addSpellPath"}} </a>
                        <a class="toggleBoolean {{#if system.itemToggle.spellPath}}armorpenalty{{/if}}" data-label="system.itemToggle.spellPath" data-ability="{{system.itemToggle.spellPath}}"><i class="{{#if system.itemToggle.spellPath}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                    </div>
                </div>
            </div>

            <div class="summoning {{#if system.toggles.summoningVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.summoning"}} </h5>
                <div>
                    <span> {{localize "abfalter.basicInfo.ability"}} </span>
                    <span> {{localize "abfalter.basicInfo.base"}} </span>
                    <span> {{localize "abfalter.basicInfo.class"}} </span>
                    <span> {{localize "abfalter.basicInfo.spec"}} </span>
                    <span> {{localize "abfalter.basicInfo.final"}} </span>
                </div>
                <div>
                    <button type="button" class="rollable" data-roll="{{system.summonfinal}}" data-label="{{localize "abfalter.magicTab.summon"}}" data-type="summoningRoll">
                        <span> {{localize "abfalter.magicTab.summon"}} </span>
                    </button>
                    <input type="number" name="system.summoning.summon.base" value="{{system.summoning.summon.base}}" />
                    <input type="number" name="system.summonbonus" value="{{system.summonbonus}}" readonly />
                    <input type="number" name="system.summoning.summon.spec" value="{{system.summoning.summon.spec}}" />
                    <input type="number" name="system.summonfinal" value="{{system.summonfinal}}" readonly />
                </div>
                <div>
                    <button type="button" class="rollable" data-roll="{{system.controlfinal}}" data-label="{{localize "abfalter.magicTab.control"}}" data-type="summoningRoll">
                        <span> {{localize "abfalter.magicTab.control"}} </span>
                    </button>
                    <input type="number" name="system.summoning.control.base" value="{{system.summoning.control.base}}" />
                    <input type="number" name="system.controlbonus" value="{{system.controlbonus}}" readonly />
                    <input type="number" name="system.summoning.control.spec" value="{{system.summoning.control.spec}}" />
                    <input type="number" name="system.controlfinal" value="{{system.controlfinal}}" readonly />
                </div>
                <div>
                    <button type="button" class="rollable" data-roll="{{system.bindfinal}}" data-label="{{localize "abfalter.magicTab.bind"}}" data-type="summoningRoll">
                        <span> {{localize "abfalter.magicTab.bind"}} </span>
                    </button>
                    <input type="number" name="system.summoning.bind.base" value="{{system.summoning.bind.base}}" />
                    <input type="number" name="system.bindbonus" value="{{system.bindbonus}}" readonly />
                    <input type="number" name="system.summoning.bind.spec" value="{{system.summoning.bind.spec}}" />
                    <input type="number" name="system.bindfinal" value="{{system.bindfinal}}" readonly />
                </div>
                <div>
                    <button type="button" class="rollable" data-roll="{{system.banishfinal}}" data-label="{{localize "abfalter.magicTab.banish"}}" data-type="summoningRoll">
                        <span> {{localize "abfalter.magicTab.banish"}} </span>
                    </button>
                    <input type="number" name="system.summoning.banish.base" value="{{system.summoning.banish.base}}" />
                    <input type="number" name="system.banishbonus" value="{{system.banishbonus}}" readonly />
                    <input type="number" name="system.summoning.banish.spec" value="{{system.summoning.banish.spec}}" />
                    <input type="number" name="system.banishfinal" value="{{system.banishfinal}}" readonly />
                </div>
            </div>

            <div class="turnDayMaint {{#if system.toggles.turnMaintVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.turnMaint"}} </h5>
                <div>
                    <span> {{localize "abfalter.basicInfo.name"}} </span>
                    <span> {{localize "abfalter.magicTab.spellCost"}} </span>
                    <span> {{localize "abfalter.magicTab.zeon"}} </span>
                </div>
                <div class="{{#if system.itemToggle.turnMaint}}item-list{{/if}}">
                    {{#each turnMaints as |turnMaint id|}}
                    <div class="turnMaint-item item equip-item" data-item-id="{{turnMaint._id}}">
                        {{#if system.expand}}
                        <div>
                            <input class="inline-edit" data-field="name" type="text" value="{{turnMaint.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                            <input class="inline-edit" data-field="system.cost" type="number" value="{{turnMaint.system.cost}}" />
                            <input class="inline-edit" data-field="system.zeon" type="number" value="{{turnMaint.system.zeon}}" />
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.description" style="grid-area: 1 / 1 / 2/ 2;">{{turnMaint.system.description}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{turnMaint.system.description}}</div>
                        </div>
                        {{else}}
                        <div class="{{#if system.equipped}}equipped{{else}}notEquipped{{/if}}">
                            <span> {{turnMaint.name}} </span>
                            <span> {{turnMaint.system.cost}} </span>
                            <span> {{turnMaint.system.zeon}} </span>
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                <div>
                    <span> {{localize "abfalter.magicTab.totalZeon"}} {{system.turnMaintRemove}} </span>
                    <button type="button" class="removeMaint" data-ability="{{system.turnMaintRemove}}">
                        <span> {{localize "abfalter.basicInfo.remove"}} </span>
                    </button>
                </div>
                <div>
                    <a class="item-create" data-type="turnMaint"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addTurnMaint"}} </a>
                    <a class="toggleBoolean {{#if system.itemToggle.turnMaint}}armorpenalty{{/if}}" data-label="system.itemToggle.turnMaint" data-ability="{{system.itemToggle.turnMaint}}"><i class="{{#if system.itemToggle.turnMaint}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                </div>
            </div>

            <div class="turnDayMaint">
                <h5> {{localize "abfalter.magicTab.dailyMaint"}} </h5>
                <div>
                    <span> {{localize "abfalter.basicInfo.name"}} </span>
                    <span> {{localize "abfalter.magicTab.spellCost"}} </span>
                    <span> {{localize "abfalter.magicTab.zeon"}} </span>
                </div>
                <div class="{{#if system.itemToggle.dailyMaint}}item-list{{/if}}">
                    {{#each dailyMaints as |dailyMaint id|}}
                    <div class="dailyMaint-item item equip-item" data-item-id="{{dailyMaint._id}}">
                        {{#if system.expand}}
                        <div>
                            <input class="inline-edit" data-field="name" type="text" value="{{dailyMaint.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                            <input class="inline-edit" data-field="system.cost" type="number" value="{{dailyMaint.system.cost}}" />
                            <input class="inline-edit" data-field="system.zeon" type="number" value="{{dailyMaint.system.zeon}}" />
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.description" style="grid-area: 1 / 1 / 2/ 2;">{{dailyMaint.system.description}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{dailyMaint.system.description}}</div>
                        </div>
                        {{else}}
                        <div class="{{#if system.equipped}}equipped{{else}}notEquipped{{/if}}">
                            <span> {{dailyMaint.name}} </span>
                            <span> {{dailyMaint.system.cost}} </span>
                            <span> {{dailyMaint.system.zeon}} </span>
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                <div>
                    <span> {{localize "abfalter.magicTab.totalZeon"}} {{system.dayMaintRemove}} </span>
                    <button type="button" class="removeMaint" data-ability="{{system.dayMaintRemove}}">
                        <span> {{localize "abfalter.basicInfo.remove"}} </span>
                    </button>
                </div>
                <div>
                    <a class="item-create" data-type="dailyMaint"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addDailyMaint"}} </a>
                    <a class="toggleBoolean {{#if system.itemToggle.dailyMaint}}armorpenalty{{/if}}" data-label="system.itemToggle.dailyMaint" data-ability="{{system.itemToggle.dailyMaint}}"><i class="{{#if system.itemToggle.dailyMaint}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                </div>
            </div>
        </div>

        <div>
            <div class="spells {{#if system.toggles.spellcastingVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.spellBook"}} </h5>
                <div class="{{#if system.itemToggle.spell}}item-list{{/if}}">
                    {{#each spells as |spell id|}}
                    <div class="spell-item item normal-item" data-item-id="{{spell._id}}">
                        {{#if system.expand}}
                        <div>
                            <div>
                                <a class="item-control item-chat"><i class="fas fa-comment-dots"></i></a>
                                <input class="item-name inline-edit" data-field="name" type="text" value="{{spell.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                                <input class="inline-edit" data-field="system.path" type="text" value="{{spell.system.path}}" />
                                <input class="inline-edit" data-field="system.level" type="number" value="{{spell.system.level}}" />
                                <a class="item-expand :"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                            </div>
                            <div>
                                <span> {{localize "abfalter.basicInfo.name"}} </span>
                                <span> {{localize "abfalter.magicTab.path"}} </span>
                                <span> {{localize "abfalter.basicInfo.level"}} </span>
                            </div>
                        </div>
                        <div>
                            <label>
                                <span> {{localize "abfalter.basicInfo.action"}} </span>
                                <select class="inline-edit" name="system.action" data-field="system.action">
                                    {{selectOptions ../actionObjList selected=system.action localize=true}}
                                </select>
                            </label>
                            <label>
                                <span> {{localize "abfalter.basicInfo.type"}} </span>
                                <select class="inline-edit" name="system.type" data-field="system.type">
                                    {{selectOptions ../spellTypeObjList selected=system.type localize=true}}
                                </select>
                            </label>
                            <label>
                                <span> {{localize "abfalter.psychicTab.pproj"}} </span>
                                <select class="inline-edit" name="system.projection" data-field="system.projection">
                                    {{selectOptions ../spellProjObjList selected=system.projection localize=true}}
                                </select>
                            </label>
                        </div>
                        <div>
                            <label>
                                <span> {{localize "abfalter.magicTab.maintType"}} </span>
                                <select class="inline-edit" name="system.maintType" data-field="system.maintType">
                                    {{selectOptions ../spellMaintTypeObjList selected=system.maintType localize=true}}
                                </select>
                            </label>
                            <label>
                                <span> {{localize "abfalter.magicTab.bought"}} </span>
                                <select class="inline-edit" name="system.bought" data-field="system.bought">
                                    {{selectOptions ../spellBoughtObjList selected=system.bought localize=true}}
                                </select>
                            </label>
                            <label> <span> {{localize "abfalter.basicInfo.cost"}} </span> <input type="number" class="inline-edit" data-field="system.cost" value="{{system.cost}}" /> </label>
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.description" style="grid-area: 1 / 1 / 2/ 2;">{{spell.system.description}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{spell.system.description}}</div>
                        </div>
                        <div>
                            <span> {{localize "abfalter.magicTab.rank"}} </span>
                            <span> {{localize "abfalter.magicTab.req"}} </span>
                            <span> {{localize "abfalter.magicTab.zeon"}} </span>
                            <span> {{localize "abfalter.magicTab.maint"}} </span>
                        </div>
                        <div>
                            <a class="item-control item-chat" data-label="basic"><i class="fas fa-comment-dots"></i></a>
                            <span> {{localize "abfalter.magicTab.basic"}} </span>
                            <input class="inline-edit" data-field="system.basic.intReq" type="text" value="{{spell.system.basic.intReq}}" />
                            <input class="inline-edit" data-field="system.basic.zeonCost" type="text" value="{{spell.system.basic.zeonCost}}" />
                            <input class="inline-edit" data-field="system.basic.maint" type="text" value="{{spell.system.basic.maint}}" />
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.basic.rollDesc" style="grid-area: 1 / 1 / 2/ 2;">{{spell.system.basic.rollDesc}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{spell.system.basic.rollDesc}}</div>
                        </div>
                        <div>
                            <a class="item-control item-chat" data-label="int"><i class="fas fa-comment-dots"></i></a>
                            <span> {{localize "abfalter.magicTab.intermidiate"}} </span>
                            <input class="inline-edit" data-field="system.intermediate.intReq" type="text" value="{{spell.system.intermediate.intReq}}" />
                            <input class="inline-edit" data-field="system.intermediate.zeonCost" type="text" value="{{spell.system.intermediate.zeonCost}}" />
                            <input class="inline-edit" data-field="system.intermediate.maint" type="text" value="{{spell.system.intermediate.maint}}" />
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.intermediate.rollDesc" style="grid-area: 1 / 1 / 2/ 2;">{{spell.system.intermediate.rollDesc}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{spell.system.intermediate.rollDesc}}</div>
                        </div>
                        <div>
                            <a class="item-control item-chat" data-label="adv"><i class="fas fa-comment-dots"></i></a>
                            <span> {{localize "abfalter.magicTab.advanced"}} </span>
                            <input class="inline-edit" data-field="system.advanced.intReq" type="text" value="{{spell.system.advanced.intReq}}" />
                            <input class="inline-edit" data-field="system.advanced.zeonCost" type="text" value="{{spell.system.advanced.zeonCost}}" />
                            <input class="inline-edit" data-field="system.advanced.maint" type="text" value="{{spell.system.advanced.maint}}" />
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.advanced.rollDesc" style="grid-area: 1 / 1 / 2/ 2;">{{spell.system.advanced.rollDesc}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{spell.system.advanced.rollDesc}}</div>
                        </div>
                        <div>
                            <a class="item-control item-chat" data-label="arc"><i class="fas fa-comment-dots"></i></a>
                            <span> {{localize "abfalter.magicTab.arcane"}} </span>
                            <input class="inline-edit" data-field="system.arcane.intReq" type="text" value="{{spell.system.arcane.intReq}}" />
                            <input class="inline-edit" data-field="system.arcane.zeonCost" type="text" value="{{spell.system.arcane.zeonCost}}" />
                            <input class="inline-edit" data-field="system.arcane.maint" type="text" value="{{spell.system.arcane.maint}}" />
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.arcane.rollDesc" style="grid-area: 1 / 1 / 2/ 2;">{{spell.system.arcane.rollDesc}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{spell.system.arcane.rollDesc}}</div>
                        </div>
                        {{else}}
                        <div>
                            <div>
                                <a class="item-control item-chat"><i class="fas fa-comment-dots"></i></a>
                                <span> {{spell.name}} </span>
                                <span> {{system.path}} </span>
                                <span> {{system.level}} </span>
                                <a class="item-expand"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                            </div>
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                <div>
                    <a class="item-control item-create" data-type="spell"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addSpell"}} </a>
                    <a class="toggleBoolean {{#if system.itemToggle.spell}}armorpenalty{{/if}}" data-label="system.itemToggle.spell" data-ability="{{system.itemToggle.spell}}"><i class="{{#if system.itemToggle.spell}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                </div>
            </div>

            <div class="metaMagic {{#if system.toggles.spellcastingVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.metaMagic"}} </h5>
                <div>
                    <span> {{localize "abfalter.metaMagic.totalCost"}} {{system.metaCost}} </span>
                    <label> <span> {{localize "abfalter.metaMagic.extraCost"}} </span> <input type="number" name="system.metaMagic.extraCost" value="{{system.metaMagic.extraCost}}" /> </label>
                    <button type="button" class="openMetaMagic">
                        <span> {{localize "abfalter.metaMagic.openTree"}} </span>
                    </button>
                </div>

                <div class="metaMagicDesc">
                    <h6> {{localize "abfalter.metaMagic.metaMaster"}} </h6>
                    {{#if system.metaMagic.doubleDmg.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.doubleDmg"}} - </span>
                        <span> {{system.doubleDamageDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.highMagic.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.highMagic"}} - </span>
                        <span> {{system.highMagicDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.natMaint.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.natMaint"}} - </span>
                        <span> {{system.natMaintDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.unlimitedZeon.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.unlimitedZeon"}} - </span>
                        <span> {{system.unlimitedZeonDesc}} </span>
                    </div>
                    {{/if}}
                </div>

                <div class="metaMagicDesc">
                    <h6> {{localize "abfalter.metaMagic.arcWarfare"}} </h6>
                    {{#if system.defenseExpertise}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.defExper"}} - </span>
                        <span> {{system.defenseExpertiseDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.empShields}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.empShields"}} - </span>
                        <span> {{system.empShieldsDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.expandArea}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.expArea"}} - </span>
                        <span> {{system.expandAreaDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.incDestruction}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.incStrength"}} - </span>
                        <span> {{system.incDestructionDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.mysticAccu}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.mysticAccu"}} - </span>
                        <span> {{system.mysticAccuDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.offExpertise}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.offeExper"}} - </span>
                        <span> {{system.offExpertiseDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.removeProtection}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.remProtect"}} - </span>
                        <span> {{system.removeProtectionDesc}} </span>
                    </div>
                    {{/if}}
                </div>

                <div class="metaMagicDesc">
                    <h6> {{localize "abfalter.metaMagic.arcEsoterica"}} </h6>
                    {{#if system.metaMagic.controlSpace.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.controlSpace"}} - </span>
                        <span> {{system.controlSpaceDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.doubleInnate.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.doubleInnate"}} - </span>
                        <span> {{system.doubleInnateDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.endureDamage.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.endureDamage"}} - </span>
                        <span> {{system.endureDamageDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.eneControl.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.eneControl"}} - </span>
                        <span> {{system.eneControlDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.feelMagic.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.feelMagic"}} - </span>
                        <span> {{system.feelMagicDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.forceSpeed}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.forceSpeed"}} - </span>
                        <span> {{system.forceSpeedDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.hiddenMagic.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.hiddenMagic"}} - </span>
                        <span> {{system.hiddenMagicDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.lifeMagic}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.lifeMagic"}} - </span>
                        <span> {{system.lifeMagicDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.secDefense.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.secDefense"}} - </span>
                        <span> {{system.secureDefenseDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.spiritLoop}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.spiritLoop"}} - </span>
                        <span> {{system.spiritLoopDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.transferMagic.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.transferMagic"}} - </span>
                        <span> {{system.transferMagicDesc}} </span>
                    </div>
                    {{/if}}
                </div>

                <div class="metaMagicDesc">
                    <h6> {{localize "abfalter.metaMagic.arcPower"}} </h6>
                    {{#if system.advnacedRegen}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.advZeonRegen"}} - </span>
                        <span> {{system.advnacedRegenDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.avatar.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.avatar"}} - </span>
                        <span> {{system.avatarDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.combinedMagic.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.combMagic"}} - </span>
                        <span> {{system.combinedMagicDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.definedMagicProj}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.definedProject"}} - </span>
                        <span> {{system.defMagProjDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.elevation.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.elevation"}} - </span>
                        <span> {{system.elevationDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.exploitEnergy}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.exploitEne"}} - </span>
                        <span> {{system.exploitEnergyDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.persisEffects.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.perEffe"}} - </span>
                        <span> {{system.persisEffectDesc}} </span>
                    </div>
                    {{/if}}
                </div>

                <div class="metaMagicDesc">
                    <h6> {{localize "abfalter.metaMagic.arcKnowledge"}} </h6>
                    {{#if system.metaMagic.bindSpells.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.bindSpell"}} - </span>
                        <span> {{system.bindSpellDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.doubleSpell.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.doubleSpell"}} - </span>
                        <span> {{system.doubleSpellDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.increRange}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.increRange"}} - </span>
                        <span> {{system.increRangeDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.maxSpells.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.maxSpells"}} - </span>
                        <span> {{system.maxSpellsDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.mysticConcen.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.mysticCon"}} - </span>
                        <span> {{system.mysticConceDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.pierceRes}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.pierceRes"}} - </span>
                        <span> {{system.pierceResDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.spellSpecialization}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.spellSpec"}} - </span>
                        <span> {{system.spellSpecializationDesc}} </span>
                    </div>
                    {{/if}}
                    {{#if system.metaMagic.supInnateSpell.bought}}
                    <div>
                        <span> {{localize "abfalter.metaMagic.supInnate"}} - </span>
                        <span> {{system.supInnateDesc}} </span>
                    </div>
                    {{/if}}
                </div>

                <div style="display: grid;">
                    <textarea class="textarea-auto-resize" name="system.metaMagic.info" style="grid-area: 1 / 1 / 2/ 2;">{{system.metaMagic.info}}</textarea>
                    <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{system.metaMagic.info}}</div>
                </div>
            </div>

            <div class="invocations {{#if system.toggles.invocationsVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.invocation"}} </h5>
                <div>
                    <span> {{localize "abfalter.basicInfo.name"}} </span>
                    <span> {{localize "abfalter.basicInfo.cost"}} </span>
                    <span> {{localize "abfalter.basicInfo.difficulty"}} </span>
                </div>
                <div class="{{#if system.itemToggle.invocation}}item-list{{/if}}">
                    {{#each invocations as |invocation id|}}
                    <div class="invocation-item item normal-item" data-item-id="{{invocation._id}}">
                        {{#if system.expand}}
                        <div>
                            <input class="inline-edit" data-field="name" type="text" value="{{invocation.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                            <input class="inline-edit" data-field="system.cost" type="number" value="{{invocation.system.cost}}" />
                            <input class="inline-edit" data-field="system.difficulty" type="number" value="{{invocation.system.difficulty}}" />
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.description" style="grid-area: 1 / 1 / 2/ 2;">{{invocation.system.description}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{invocation.system.description}}</div>
                        </div>
                        {{else}}
                        <div>
                            <span> {{invocation.name}} </span>
                            <span> {{invocation.system.cost}} </span>
                            <span> {{invocation.system.difficulty}} </span>
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                <div>
                    <a class="item-create" data-type="invocation"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addInvocation"}} </a>
                    <a class="toggleBoolean {{#if system.itemToggle.invocation}}armorpenalty{{/if}}" data-label="system.itemToggle.invocation" data-ability="{{system.itemToggle.invocation}}"><i class="{{#if system.itemToggle.invocation}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                </div>
            </div>

            <div class="incarnations {{#if system.toggles.incarnationsVis}}hidden{{/if}}">
                <h5> {{localize "abfalter.magicTab.incarnation"}} </h5>
                <div>
                    <span> {{localize "abfalter.basicInfo.name"}} </span>
                    <span> {{localize "abfalter.basicInfo.level"}} </span>
                    <span> {{localize "abfalter.basicInfo.cost"}} </span>
                    <span> {{localize "abfalter.basicInfo.difficulty"}} </span>
                </div>
                <div class="{{#if system.itemToggle.incarnation}}item-list{{/if}}">
                    {{#each incarnations as |incarnation id|}}
                    <div class="incarnation-item item normal-item" data-item-id="{{incarnation._id}}">
                        {{#if system.expand}}
                        <div>
                            <input class="inline-edit" data-field="name" type="text" value="{{incarnation.name}}" placeholder="{{localize "abfalter.sheet.nameItem"}}" />
                            <input class="inline-edit" data-field="system.level" type="number" value="{{incarnation.system.level}}" />
                            <input class="inline-edit" data-field="system.cost" type="number" value="{{incarnation.system.cost}}" />
                            <input class="inline-edit" data-field="system.difficulty" type="number" value="{{incarnation.system.difficulty}}" />
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        <div class="textarea-div" style="display: grid;">
                            <textarea class="inline-edit textarea-auto-resize" data-field="system.description" style="grid-area: 1 / 1 / 2/ 2;">{{incarnation.system.description}}</textarea>
                            <div class="textarea-auto-resize-sibling" aria-hidden="true" style="visibility: hidden; grid-area: 1 / 1 / 2 / 2;">{{incarnation.system.description}}</div>
                        </div>
                        {{else}}
                        <div>
                            <span> {{incarnation.name}} </span>
                            <span> {{incarnation.system.level}} </span>
                            <span> {{incarnation.system.cost}} </span>
                            <span> {{incarnation.system.difficulty}} </span>
                            <a class="item-expand {{#if system.expand}}showOpacity{{/if}}"><i class="{{#if system.expand}}fas fa-caret-up{{else}}fas fa-caret-down{{/if}}"></i></a>
                        </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
                <div>
                    <a class="item-create" data-type="incarnation"><i class="fas fa-plus"></i> {{localize "abfalter.magicTab.addSpellPath"}} </a>
                    <a class="toggleBoolean {{#if system.itemToggle.incarnation}}armorpenalty{{/if}}" data-label="system.itemToggle.incarnation" data-ability="{{system.itemToggle.incarnation}}"><i class="{{#if system.itemToggle.incarnation}}fa-solid fa-bars-staggered{{else}}fa-solid fa-bars{{/if}}"></i> {{localize "abfalter.sheet.modify"}} </a>
                </div>
            </div>
        </div>
    </div>
</div>